// Generated by CoffeeScript 1.4.0
(function() {
  var CogAnimation, _ref,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  if ((_ref = window.Amoeba) == null) {
    window.Amoeba = {};
  }

  Amoeba.CogDemo = (function() {

    function CogDemo(divHolder, size, numSegments) {
      var _this = this;
      this.size = size;
      this.numSegments = numSegments;
      this._start = __bind(this._start, this);

      this.graphicsPaper = new Amoeba.GraphicsPaper(divHolder, {
        fill: "90-#fff-#bec0c6",
        stroke: "#f99"
      });
      Amoeba.oneText = $("#one");
      Amoeba.twoText = $("#two");
      Amoeba.threeText = $("#three");
      Amoeba.fourText = $("#four");
      this.cog = new Amoeba.Cog(this.size, this.numSegments, this.graphicsPaper);
      Amoeba.oneText.val(this.cog.path(true));
      Amoeba.twoText.val(this.cog.path(false));
      Amoeba.threeText.val(Amoeba.Graphics.circleWithFourPoints(0, 0, this.size / 2));
      Amoeba.fourText.val(Amoeba.Graphics.rectWithFourPoints(0, 0, 100, 300));
      $("#run").on("click", function(event) {
        return _this._start();
      });
      $("#showPoints").on("click", function(event) {
        return _this.cog.showPoints();
      });
      $("#hidePoints").on("click", function(event) {
        return _this.graphicsPaper.clearPoints();
      });
      $("#pulsatePoints").on("click", function(event) {
        return _this.graphicsPaper.pulsatePoints();
      });
      this._start();
    }

    CogDemo.prototype._start = function() {
      var one, _i, _j, _len, _len1, _ref1, _ref2, _results;
      if (this.animations != null) {
        _ref1 = this.animations;
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          one = _ref1[_i];
          one.remove();
        }
      }
      this.animations = [new CogAnimation(Raphael.getColor(), 0, this.graphicsPaper), new CogAnimation(Raphael.getColor(), 1, this.graphicsPaper), new CogAnimation(Raphael.getColor(), 2, this.graphicsPaper), new CogAnimation(Raphael.getColor(), 3, this.graphicsPaper), new CogAnimation(Raphael.getColor(), 4, this.graphicsPaper)];
      _ref2 = this.animations;
      _results = [];
      for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
        one = _ref2[_j];
        _results.push(one.start());
      }
      return _results;
    };

    return CogDemo;

  })();

  CogAnimation = (function() {

    function CogAnimation(fillColor, index, graphicsPaper) {
      var _this = this;
      this.fillColor = fillColor;
      this.index = index;
      this.changeToPathFive = __bind(this.changeToPathFive, this);

      this.changeToPathFour = __bind(this.changeToPathFour, this);

      this.changeToPathThree = __bind(this.changeToPathThree, this);

      this.changeToPathTwo = __bind(this.changeToPathTwo, this);

      this.rotate = __bind(this.rotate, this);

      this.pathSwitch = true;
      this.removed = false;
      this.mainPath = graphicsPaper.paper.path(this.pathOne()).attr({
        fill: this.fillColor,
        opacity: 0,
        transform: "t" + (graphicsPaper.width()) + ",0"
      });
      this.mainPath.node.onclick = function() {
        _this.animate();
        return _this.mainPath.toFront();
      };
    }

    CogAnimation.prototype.remove = function() {
      var _this = this;
      this.removed = true;
      return this.mainPath.animate({
        opacity: 0
      }, 400, "<>", function() {
        return _this.mainPath.remove();
      });
    };

    CogAnimation.prototype.start = function() {
      var _this = this;
      return setTimeout(function() {
        return _this._start();
      }, 100 * this.index);
    };

    CogAnimation.prototype._start = function() {
      var _this = this;
      this._stop();
      return this.mainPath.animate({
        opacity: 1,
        transform: "t0,0"
      }, 600, "<>", function() {
        return _this.rotate();
      });
    };

    CogAnimation.prototype._stop = function() {
      if (!this.removed) {
        return this.mainPath.stop();
      }
    };

    CogAnimation.prototype.rotate = function() {
      var _this = this;
      return this.mainPath.animate({
        transform: "r0"
      }, 0, "", function() {
        return _this.mainPath.animate({
          transform: "r360"
        }, 1000, "<>", function() {
          return _this.changeToPathTwo();
        });
      });
    };

    CogAnimation.prototype.changeToPathTwo = function() {
      var _this = this;
      return this.mainPath.animate({
        path: this.pathTwo()
      }, 800, "<>", function() {
        return _this.changeToPathThree();
      });
    };

    CogAnimation.prototype.changeToPathThree = function() {
      var _this = this;
      return this.mainPath.animate({
        path: this.pathThree()
      }, 0, "", function() {
        return _this.changeToPathFour();
      });
    };

    CogAnimation.prototype.changeToPathFour = function() {
      var _this = this;
      return this.mainPath.animate({
        path: this.pathFour()
      }, 800, "<>", function() {
        return _this.changeToPathFive();
      });
    };

    CogAnimation.prototype.changeToPathFive = function() {
      var _this = this;
      return setTimeout(function() {
        var bBox, diff;
        bBox = _this.mainPath.getBBox();
        diff = 700 - bBox.y2;
        return _this.mainPath.animate({
          transform: "t0," + diff
        }, 800, "bounce", function() {
          var newPath;
          newPath = Amoeba.Graphics.scalePath(_this.mainPath, 1, 2);
          return _this.mainPath.animate({
            path: newPath
          }, 800, "<>", function() {
            newPath = Amoeba.Graphics.scalePath(newPath, 1, 1);
            return _this.mainPath.animate({
              path: newPath
            }, 800, "<>");
          });
        });
      }, 500);
    };

    CogAnimation.prototype.pathOne = function() {
      var result;
      result = Amoeba.oneText.val();
      result = Amoeba.Graphics.normalizePath(result);
      result = Amoeba.Graphics.translatePath(result, this.index * 120, 0);
      return result;
    };

    CogAnimation.prototype.pathTwo = function() {
      var result;
      result = Amoeba.twoText.val();
      result = Amoeba.Graphics.normalizePath(result);
      result = Amoeba.Graphics.scalePath(result, .5, .5);
      result = Amoeba.Graphics.translatePath(result, 100 + this.index * 220, 120);
      return result;
    };

    CogAnimation.prototype.pathThree = function() {
      var result;
      result = Amoeba.threeText.val();
      result = Amoeba.Graphics.normalizePath(result);
      result = Amoeba.Graphics.scalePath(result, .5, .5);
      result = Amoeba.Graphics.translatePath(result, 100 + this.index * 220, 120);
      return result;
    };

    CogAnimation.prototype.pathFour = function() {
      var result;
      result = Amoeba.fourText.val();
      result = Amoeba.Graphics.normalizePath(result);
      result = Amoeba.Graphics.scalePath(result, .5, .5 + .3 * this.index);
      result = Amoeba.Graphics.translatePath(result, 500 + this.index * 50, 220);
      return result;
    };

    return CogAnimation;

  })();

}).call(this);
